---
import Loading from "@components/Loading.astro";
import Layout from "@layouts/Layout.astro";
---

<Layout title="" noHeader="true">
    <Loading />
</Layout>
<script>
    import { EventHandler } from "@utils/events";
    import { defaultStore } from "@utils/storage";
    import { navigate } from "astro:transitions/client";
    const eHandler = new EventHandler({
        events: {
            "astro:page-load": () => {
                let currentLang = localStorage.getItem("selectedLanguage");
                if (currentLang) {
                    try {
                        let parsed = JSON.parse(currentLang).value;
                        switch (parsed) {
                            case "en_US":
                                navigate("/en_US/");
                                break;
                            case "jp":
                                navigate("/jp/");
                                break;
                            default:
                                navigate("/en_US/");
                        }
                    } 
                    catch {
                        localStorage.clear();
                        window.location.reload();
                    }
                } 
                else {
                    if (navigator.language.includes("ja")) {
                        defaultStore.setVal("selectedLanguage", JSON.stringify({ value: "jp" }));
                        navigate("/jp/");
                    } 
                    else {
                        defaultStore.setVal("selectedLanguage", JSON.stringify({ value: "en_US" }));
                        navigate("/en_US/");
                    }
                }
            }
        },
        logging: false
    });
    //Bind the events.
    eHandler.bind();
</script>
<noscript>
    JavaScript is required to run this app.
</noscript>
